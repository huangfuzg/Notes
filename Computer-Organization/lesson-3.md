### 03 | 通过你的 CPU 主频，我们来谈谈 “性能” 究竟是什么？

计算机的性能，衡量的标准有两个指标： **响应时间** 和 **吞吐率**。

#### 响应时间(Response time)

或者叫执行时间(Execution time)。想要提升这个指标，可以理解为让计算机 “跑得更快”。

##### 提升

1. 缩短响应时间


#### 吞吐率(Throughput)

或者叫带宽(Bandwidth)，想要提升这个指标，可以理解为让计算机 “搬得更多”。

##### 提升

1. 多找几个人来搬。比如：4核，6核，8核...

---

一般把性能，定义成响应时间的倒数，也就是：

​			性能 = 1 / 响应时间

手机跑分软件，就是把多个预设好的程序在手机上运行，然后根据运行需要的时间，算出一个分数来给出手机的性能评估。  在业界，各大 CPU 和服务器厂商组织了一个叫做 **SPEC**(Standard Performance Evaluation Corporation) 的第三方机构，专门用来指定各种 “跑分” 规则。

#### 计算机的计时单位： CPU 时钟

**Wall Clock: ** 程序运行结束时间 - 程序开始运行时间。或者叫：Elapsed Time。

这个时间并不准确，因为 CPU 也会去在某个瞬间执行其他程序，而且有些程序运行的时候，可能要从网络、硬盘去读取数据，等到读取出来才能给到内存和 CPU。所以，**要想准确统计某个程序运行时间，进而比较两个程序的实际性能，要把这些时间给刨除掉。**

Linux 下有一个 time 命令，可以统计出三个时间：**real time、user time、sys time**。

**real time:**

​	就是 Wall Clock Time，也就是运行程序整个过程中流失掉的时间。

**user time:**	

​	CPU 在运行你的程序，在用户态运行指令的时间。

**sys time:**

​	CPU 在运行你的程序，在操作系统内核里运行指令的时间。

因此，**程序实际花费的 CPU 执行时间(CPU Time)，就是 user time + sys time**。

为了看到实际效果，可以在 Linux 环境下，运行下面的命令：

```
#生成从1到10亿个整数，消耗的时间。
time seq 1000000000 | wc -l
```

**结果：**

```shell
real    0m15.862s
user    0m18.313s
sys     0m12.688s
```

user > real，是因为多核运行了。也就是说 user + sys 是多个核心时间的总和，如果除以核心数，肯定小于 real。

**就算得到了 CPU 执行时间，也不一定能比较出 2 个程序的性能差异。**因为 CPU 运行可能降频，时间也会受到主板、内存的影响。所以，**需要对“时间”进行拆解，拆成：CPU 时钟周期数(CPU Cycles) x 时钟周期时间(Clock Cycle)**。

时钟周期时间 = 1 / 主频

```
CPU Time = CPU Cycles x Clock Cycle
```

如果不改变硬件，想提升性能，就要降低 **CPU 时钟周期数**。可进一步分解为：

```
CPU Cycles = 指令数 x 每条指令的平均时钟周期数（Cycles Per Instruction,简称 CPI）
```

#### 优化考虑 3 点：

1. 时钟周期时间，就是提高计算机的主频。
2. CPI，降低每条指令的平均时钟周期数。
3. 指令数，降低程序编译后的计算机指令数。

#### 课后思考

新手机发布的时候，会有跑分结果。甚至有 “作弊” 跑分和 “针对跑分优化” 的说法。是如何做到的？

1. 让 CPU 超频运行，温度高了也不降频。







